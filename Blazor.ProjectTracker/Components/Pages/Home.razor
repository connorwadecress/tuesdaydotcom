@page "/"
@rendermode InteractiveServer
@using Blazor.ProjectTracker.Components.SharedComponents
@using global::ProjectTracker.Domain.Entities
@inject NavigationManager Navigation

<style>
    .table-dark           { width: 100% !important; }
    .tag-pill             { display:inline-block; margin-right:4px; padding:2px 6px;
                             border-radius:4px; font-size:0.85em; white-space:nowrap; }
    .project-row          { cursor:pointer; transition:background-color .2s; }
    .project-row:hover    { background:#343a40; }
</style>

<div style="background:#1a1a1a;color:#fff;min-height:100vh;padding:2rem;">
    <div class="d-flex align-items-center mb-4">
        <h1 class="display-4 m-0">My Projects</h1>

        <MudButton Variant="Variant.Outlined" Color="Color.Primary" Class="ms-auto"
                   Style="width:38px; height:38px; font-size:1.5rem; line-height:1;"
                   Title="Add project"
                   OnClick="AddProject">
            +
        </MudButton>
    </div>

    <div class="d-flex justify-content-end mb-3">
        <span class="text-secondary">Showing @Projects.Count projects</span>
    </div>

    <table class="table table-dark table-striped w-100">
        <thead>
            <tr>
                <th style="width:30%;">Project Name</th>
                <th style="width:30%;">Tags</th>
                <th style="width:20%;">Status</th>
                <th style="width:20%;">Date Created</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var p in Projects)
            {
                <RowComponent Title="@p.Name"
                              Tags="@p.Tags.ToList()"
                              Status="@p.Status"
                              Date="@p.DateCreated"
                              OnClick="() => OnRowClicked(p)" />
            }
        </tbody>
    </table>
</div>

@code {
    private List<Project> Projects = new();

    protected override void OnInitialized()
    {
        var tag1 = new Tag { Name = "IoT", Color = 0x2ecc71, IsFontBlack = false };
        var tag2 = new Tag { Name = "Raspberry Pi", Color = 0x3498db, IsFontBlack = false };
        var tag3 = new Tag { Name = "C#", Color = 0xe67e22, IsFontBlack = true };

        Projects = new List<Project>
        {
            new Project
            {
                Id = 1,
                Name = "Smart Home Controller",
                DateCreated = new DateTime(2024, 6, 10),
                Status = "Completed",
                Tags = new List<Tag> { tag1, tag2, tag3 }
            }
        };
    }

    private void OnRowClicked(Project p)
    {
        Navigation.NavigateTo($"/project/{p.Id}");
    }

    private void AddProject()
    {
        // Placeholder for actual add logic
    }
}
