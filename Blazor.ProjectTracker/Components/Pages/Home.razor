@page "/"
@using System.Globalization

<style>
    .tag-pill {
        display: inline-block;
        padding: 1px 6px;
        margin-right: 5px;
        border-radius: 12px;
        font-size: 0.75em;
        color: #fff;
        white-space: nowrap;
    }

    .project-row {
        cursor: pointer;
        height: 40px; /* Fixed height */
        overflow: hidden;
    }

    .project-row td {
        padding: 0 8px;
        height: 40px; /* Match fixed height */
        vertical-align: middle;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }

    .table-full-page {
        width: 100%;
    }

    .table th {
        padding: 6px 8px;
        height: 40px;
        vertical-align: middle;
    }

    .project-row:hover {
        background-color: #2c2c2c;
    }
</style>

<div style="background-color:#1a1a1a; color:#ffffff; min-height:100vh; padding: 2rem;">
    <!-- heading row with + button -->
    <div style="display:flex; align-items:center; justify-content:space-between;" class="mb-4">
        <h1 class="display-4 m-0">My Projects</h1>

        <!-- + button (inherits your page colors) -->
        <button style="background:none; border:1px solid #ffffff; color:#ffffff; width:38px; height:38px; font-size:1.5rem; line-height:1;"
                title="Add project"
                @onclick="AddProject">
            +
        </button>
    </div>

    <div class="d-flex justify-content-end mb-3">
        <span class="text-secondary">Showing @AllProjects.Count projects</span>
    </div>

    <table class="table table-dark table-striped table-full-page">
        <thead>
            <tr>
                <th style="width: 30%;">Project Name</th>
                <th style="width: 30%;">Tags</th>
                <th style="width: 20%;">Status</th>
                <th style="width: 20%;">Date</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var project in AllProjects)
            {
                <tr class="project-row" @onclick="() => OnRowClicked(project)">
                    <td>@project.Title</td>
                    <td>
                        @foreach (var tag in project.Tags)
                        {
                            <span class="tag-pill" style="background:@tag.Color">@tag.Text</span>
                        }
                    </td>
                    <td>@project.Status</td>
                    <td>@project.Date.ToString("MMM d, yyyy", CultureInfo.InvariantCulture)</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@code {
    public record TagDto(string Text, string Color);

    public record Project(
        string Title,
        DateTime Date,
        TagDto[] Tags,
        string Status,
        string? Description = null
    );

    private List<Project> AllProjects = new();

    protected override void OnInitialized()
    {
        AllProjects = new List<Project>
        {
            new(
                "Smart Home Controller",
                new DateTime(2024, 6, 10),
                new[]
                {
                    new TagDto("IoT", "#2ecc71"),
                    new TagDto("Raspberry Pi", "#3498db"),
                    new TagDto("C#", "#e67e22")
                },
                "Completed"
            ),
        };
    }

    private void OnRowClicked(Project project)
    {
        Console.WriteLine($"Project clicked: {project.Title}");
        // You can navigate or show a modal here
    }

    private void AddProject()
    {
        Console.WriteLine("Add project clicked.");
        // Open 'new project' form or modal
    }
}
